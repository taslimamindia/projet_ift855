name: CI - Build & Test Frontend

on:
  pull_request:
    branches:
      - development
  workflow_dispatch:

jobs:
  build-and-test:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: 18

      - name: Install dependencies
        working-directory: ./frontend
        run: npm ci || npm install

      - name: Build project
        working-directory: ./frontend
        run: npm run build

      - name: Run tests (CI mode)
        working-directory: ./frontend
        run: npm run test:ci

  validate-merge:
    needs: build-and-test
    runs-on: ubuntu-latest
    if: always()
    steps:
      - name: Merge allowed
        if: needs.build-and-test.result == 'success'
        run: echo "✅ Tests passed, merge is allowed."

      - name: Merge blocked
        if: needs.build-and-test.result != 'success'
        run: echo "❌ Tests failed, merge is blocked."
